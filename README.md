## 简介
此项目为公主连接简体字b服40对1刷玛娜脚本. 使用opencv图像识别进行按钮分析<br>
本脚本基于 https://github.com/panshujia/pcr-farm-script 主要增加了多线程支持，增加了日志功能方便回溯调试，调整代码结构并重写所有操作类函数有更好的功能扩展性<br>
**截图警告：目前只有2k屏的识别素材，其它分辨率的屏幕需要重新截图！！也欢迎将自己截的1080或4k屏的素材分享给我，我会在此项目中署名感谢~<br>
注意：使用上需要有代码能力和debug能力，请根据自己的条件和需求调整脚本参数和代码，达到最好的效果,也可以增加自己想要的功能**


## 功能
* 40对1刷mana，大号自动加农场，刷完两个农场然后从农场退出来
* 完成每日任务刷小号经验(目前可完成免费扭蛋、购买玛娜、3次困难1-1、10次普通1-1)可设置碎钻刷1-1，自动领取任务和邮件奖励，后续加入更多...
* 根据账号列表和行会名自动创建和加入农场行会
* 3星通关困难1-1


## 环境
* Python版本3.8
* 雷电模拟器4.0，分辨率设置为 平板版 960×540(dpi160)
* 硬件环境高配建议开6个模拟器，低配建议开4个，模拟器开的越多执行耗时越短
* 最好使用PyCharm编辑和运行脚本，不保证其它集成环境的可靠性


## 使用方法
1. 准备环境：
    * 安装python（安装时记得把带有PATH字母选项的勾上）
    * 安装好雷电模拟器后，用雷电多开器创建一个模拟器，在这个模拟器里通过应用商店下载安装公主连结b服
    * 打开公主连结，等待游戏数据安装完毕
    * 在雷电多开器里复制已准备好的模拟器（建议在多开数量的基础上再预留几个用于debug）
    
2. 截取要上架的支援角色的头像：
    * 在模拟器上登录大号，按键盘`F11`进入**全屏模式**（不要点右上角的最大化窗口，要按f11进全屏）
    * 在选择角色弹窗里截要做为支援的角色，替换images文件夹里的iv_aid.png（建议不要截到等级和星级，参考iv_aid.png的样子）
    <br>**_注意：游戏限制借支援不能借超过自身等级30级的角色_**
    
3. 设置脚本：
    * 在`parameters.py`模块里填写账号信息和电脑屏幕分辨率（**目前只有2k屏的素材，其它分辨率的屏幕需要重新截图**）
    * 在`accountlist.txt`和`accountlist2.txt`里填入农场号数据，一个文件为1个行会，每个文件最多29个号
    
        ```
        格式（账号+空格+密码+回车换行） 如下所示
        id1 password1
        id2 password2
        id3 password3
        ...
        ```
    * 在`main.py`模块里定制要执行的任务
    
4. 运行脚本：
    * 根据电脑性能启动多个模拟器，模拟器停留在手机home页面（脚本会自动启动游戏，如果是渠道服包名可能不一样需要先手动启动游戏，之后不要做其它操作）
    * 运行`main.py`，观察效果


## 补充
* 游戏限制借支援不能借超过自身等级30级的角色，购买农场号和设置支援的时候注意一下
* 截图时模拟器要处于全屏状态（不要点右上角的最大化窗口，要按f11进全屏），截图最后参照已有的素材来截
* 默认参数比较保守，可根据自己情况调整`parameters`模块里的参数以优化性能
* 如需中文输入模拟器要安装并设置ADBKeyboard，并根据`device`模块`input()`里的注释修改代码


* 截图推荐使用 [snipaste](https://zh.snipaste.com/index.html) 截图工具
* 素材管理可以用 [Everything](https://www.voidtools.com/) 搜索工具来做辅助
* 欢迎来交流代码提出改进建议


## 更新历史
* 2020/8/4
    * 增加买8管体以上的刷1-1的任务，用于紧急提升等级
    * 代码细节优化提升性能
    
* 2020/8/8
    * 优化登录逻辑，现在会记录登录失败的账号，在循环登录多个账号的action里，当前账号登录失败会跳过剩下的操作节省时间
    * 优化脚本执行前后的逻辑，现在脚本执行前会弹对话框来确认账号信息，脚本执行完毕后会弹对话框告知耗时和登录失败的账号

## 免责声明
当你下载或使用本项目，将默许<br>
本项目仅供交流和学习使用，请勿用此从事 违法/商业盈利等，开发者拥有本项目的最终解释权